<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --primary: #2c3e50; --success: #27ae60; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #f0f2f5; margin: 0; padding: 20px; text-align: center; }
        .container { max-width: 800px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .upload-section { border: 2px dashed #bdc3c7; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        input[type="file"] { margin: 10px 0; }
        .btn { background: var(--primary); color: white; border: none; padding: 15px 30px; border-radius: 8px; cursor: pointer; font-size: 16px; transition: 0.3s; width: 100%; }
        .btn:hover { opacity: 0.9; }
        #status { margin-top: 20px; font-weight: bold; color: var(--primary); }
        .download-link { display: block; margin-top: 10px; color: var(--success); text-decoration: none; font-weight: bold; border: 1px solid var(--success); padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“ Ù†Ø¸Ø§Ù… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª (PDF)</h2>
    <p>ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ÙƒØµÙˆØ±Ø© (Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ©) ÙˆÙ…Ù„Ù Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</p>

    <div class="upload-section">
        <label>1. ØµÙˆØ±Ø© Ø§Ù„Ù‚Ø§Ù„Ø¨ (High Res):</label><br>
        <input type="file" id="bgInput" accept="image/*"><br><br>
        
        <label>2. Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„ (Ø§Ù„Ø£Ø³Ù…Ø§Ø¡):</label><br>
        <input type="file" id="excelInput" accept=".xlsx, .xls">
    </div>

    <button class="btn" onclick="generatePDFs()">Ø¨Ø¯Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„ÙØ§Øª PDF</button>
    
    <div id="status"></div>
    <div id="downloadArea"></div>
</div>

<script>
    async function generatePDFs() {
        const { jsPDF } = window.jspdf;
        const bgFile = document.getElementById('bgInput').files[0];
        const excelFile = document.getElementById('excelInput').files[0];
        const status = document.getElementById('status');
        const downloadArea = document.getElementById('downloadArea');

        if (!bgFile || !excelFile) {
            alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©");
            return;
        }

        status.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©... ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±";
        downloadArea.innerHTML = "";

        // 1. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©
        const bgBase64 = await toBase64(bgFile);
        const img = new Image();
        img.src = bgBase64;

        img.onload = async function() {
            // 2. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¥ÙƒØ³Ù„
            const reader = new FileReader();
            reader.onload = async function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                const rows = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]], {header: 1});
                
                const names = rows.slice(1, 4).map(r => r[0]); // Ø£ÙˆÙ„ 3 Ø£Ø³Ù…Ø§Ø¡

                for (let name of names) {
                    if (!name) continue;

                    // Ø¥Ù†Ø´Ø§Ø¡ PDF Ù„ÙƒÙ„ Ø§Ø³Ù… Ø¨Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ© (A4 Landscape)
                    const pdf = new jsPDF({
                        orientation: 'landscape',
                        unit: 'px',
                        format: [img.width, img.height]
                    });

                    // Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© Ø§Ù„Ù‚Ø§Ù„Ø¨
                    pdf.addImage(bgBase64, 'PNG', 0, 0, img.width, img.height);

                    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®Ø· (Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¹Ø¨Ø¯Ø§Ù„ÙØªØ§Ø­ ØµÙ„Ø§Ø­)
                    pdf.setTextColor(0, 0, 0);
                    const fontSize = Math.floor(img.height * 0.05); 
                    pdf.setFont("times", "bold"); 
                    pdf.setFontSize(fontSize);

                    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø§Ø³Ù… ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ (Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª 43% Ù…Ù† Ø§Ù„Ø§Ø±ØªÙØ§Ø¹)
                    const text = name.toString().toUpperCase();
                    const textWidth = pdf.getTextWidth(text);
                    const x = (img.width - textWidth) / 2;
                    const y = img.height * 0.43;

                    pdf.text(text, x, y);

                    // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„
                    const blob = pdf.output('blob');
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `Ø´Ù‡Ø§Ø¯Ø©_${name}.pdf`;
                    link.className = "download-link";
                    link.innerText = `ØªØ­Ù…ÙŠÙ„ PDF: ${name}`;
                    downloadArea.appendChild(link);
                }
                status.innerText = "ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ù†Ø¬Ø§Ø­!";
            };
            reader.readAsArrayBuffer(excelFile);
        };
    }

    function toBase64(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });
    }
</script>

</body>
</html>

