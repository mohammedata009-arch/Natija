<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø³ØªØ®Ø±Ø¬ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ø°ÙƒÙŠ</title>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/@pdf-lib/fontkit@0.0.4/dist/fontkit.umd.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f7f9; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 100%; max-width: 450px; text-align: center; }
        h2 { color: #2c3e50; margin-bottom: 20px; }
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        button { width: 100%; padding: 15px; margin-top: 15px; background: #1a73e8; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { background: #1557b0; }
        .footer { margin-top: 15px; font-size: 12px; color: #7f8c8d; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ“ ØµØ§Ù†Ø¹ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ø°ÙƒÙŠ</h2>
    <p>ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ø¨Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©</p>
    
    <input type="file" id="pdfTemplate" accept=".pdf">
    <input type="text" id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¯Ø±Ø¨ Ø§Ù„ÙƒØ§Ù…Ù„">
    <input type="text" id="trainer" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø¨">
    <input type="text" id="date" placeholder="Ø§Ù„ØªØ§Ø±ÙŠØ®">
    <input type="text" id="serial" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ">
    
    <button id="generateBtn" onclick="generateCertificate()">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø¢Ù† âœ…</button>
    <p id="status" style="display:none; color: #e67e22;">Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø®Ø·ÙˆØ·ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...</p>
    
    <div class="footer">Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</div>
</div>

<script>
    async function generateCertificate() {
        const pdfInput = document.getElementById('pdfTemplate').files[0];
        const name = document.getElementById('name').value;
        const btn = document.getElementById('generateBtn');
        const status = document.getElementById('status');

        if (!pdfInput || !name) {
            alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù PDF ÙˆØ¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¯Ø±Ø¨");
            return;
        }

        btn.disabled = true;
        status.style.display = "block";

        try {
            // 1. Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø§Ù„Ù€ PDF Ø§Ù„Ø£ØµÙ„ÙŠ
            const existingPdfBytes = await pdfInput.arrayBuffer();
            const pdfDoc = await PDFLib.PDFDocument.load(existingPdfBytes);
            
            // 2. ØªÙØ¹ÙŠÙ„ Ø¯Ø¹Ù… Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©
            pdfDoc.registerFontkit(fontkit);

            // 3. ØªØ­Ù…ÙŠÙ„ Ø®Ø· Ø¹Ø±Ø¨ÙŠ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠØ© (Cairo)
            const fontUrl = 'https://raw.githubusercontent.com/googlefonts/cairo/main/fonts/ttf/Cairo-Bold.ttf';
            const fontBytes = await fetch(fontUrl).then(res => res.arrayBuffer());
            const customFont = await pdfDoc.embedFont(fontBytes);

            const pages = pdfDoc.getPages();
            const firstPage = pages[0];
            const { width, height } = firstPage.getSize();

            // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙƒØªØ§Ø¨Ø©
            const drawText = (text, x, y, size) => {
                firstPage.drawText(text, {
                    x: x,
                    y: y,
                    size: size,
                    font: customFont,
                    color: PDFLib.rgb(0, 0, 0),
                });
            };

            // 4. ÙˆØ¶Ø¹ Ø§Ù„Ù†ØµÙˆØµ ÙÙŠ Ø£Ù…Ø§ÙƒÙ†Ù‡Ø§ (ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ù‡Ù†Ø§)
            // ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø³Ù… ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹
            drawText(name, width / 2 - (name.length * 5), height / 2 + 30, 30);
            
            // Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
            const trainerName = document.getElementById('trainer').value;
            const dateStr = document.getElementById('date').value;
            const serialNum = document.getElementById('serial').value;

            if (trainerName) drawText(trainerName, 150, 200, 16);
            if (dateStr) drawText(dateStr, 400, 200, 16);
            if (serialNum) drawText("ID: " + serialNum, 50, height - 50, 12);

            // 5. Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù ÙˆØªØ­Ù…ÙŠÙ„Ù‡
            const pdfBytes = await pdfDoc.save();
            const blob = new Blob([pdfBytes], { type: "application/pdf" });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `Certificate_${name}.pdf`;
            link.click();

        } catch (err) {
            console.error(err);
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©. ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.");
        } finally {
            btn.disabled = false;
            status.style.display = "none";
        }
    }
</script>

</body>
</html>
