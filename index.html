<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ø°ÙƒÙŠ</title>
    <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --main-color: #d35400;
            --secondary-color: #e67e22;
            --bg-color: #f8f9fa;
        }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg-color); margin: 0; padding: 20px; text-align: center; }
        .card { max-width: 600px; margin: auto; background: white; padding: 40px; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        
        h2 { color: var(--main-color); margin-bottom: 30px; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±ÙØ¹ Ø¨ØªØµÙ…ÙŠÙ… Ø¹ØµØ±ÙŠ */
        .upload-area { border: 2px dashed #ddd; padding: 25px; margin-bottom: 25px; border-radius: 15px; background: #fffcf9; transition: all 0.3s; }
        .upload-area:hover { border-color: var(--main-color); background: #fff5eb; }
        input[type="file"] { margin: 10px 0; font-size: 14px; }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© */
        .btn-glow {
            background: linear-gradient(45deg, var(--main-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 18px 30px;
            width: 100%;
            border-radius: 50px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 15px rgba(211, 84, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn-glow:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 20px rgba(211, 84, 0, 0.4);
            filter: brightness(1.1);
        }
        .btn-glow:active { transform: translateY(1px); }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© */
        #resultArea { margin-top: 30px; text-align: right; }
        .item-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fff;
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 12px;
            border-right: 5px solid var(--main-color);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            animation: fadeIn 0.5s ease forwards;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .action-btns { display: flex; gap: 10px; }
        .sub-btn {
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            transition: 0.2s;
        }
        .preview-btn { border: 1px solid var(--main-color); color: var(--main-color); }
        .preview-btn:hover { background: var(--main-color); color: #fff; }
        
        .download-btn { background: #27ae60; color: white; }
        .download-btn:hover { background: #219150; box-shadow: 0 4px 10px rgba(39, 174, 96, 0.3); }

        .loader { display: none; margin: 20px auto; border: 4px solid #f3f3f3; border-top: 4px solid var(--main-color); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="card">
    <h2>âœ¨ ØµØ§Ù†Ø¹ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø­Ø±ÙŠ</h2>
    
    <div class="upload-area">
        <label>ğŸ“¥ Ø§Ø±ÙØ¹ Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© (PDF):</label><br>
        <input type="file" id="pdfInput" accept=".pdf">
        <br><br>
        <label>ğŸ“Š Ø§Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ (Excel):</label><br>
        <input type="file" id="excelInput" accept=".xlsx, .xls">
    </div>

    <button class="btn-glow" onclick="process()">
        <span>ğŸš€</span> Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø¢Ù†
    </button>

    <div id="loader" class="loader"></div>
    <div id="resultArea"></div>
</div>

<script>
    async function process() {
        const pdfFile = document.getElementById('pdfInput').files[0];
        const excelFile = document.getElementById('excelInput').files[0];
        if (!pdfFile || !excelFile) return alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„ÙØ§Øª Ø£ÙˆÙ„Ø§Ù‹!");

        document.getElementById('loader').style.display = 'block';
        document.getElementById('resultArea').innerHTML = "";

        const pdfBytes = await pdfFile.arrayBuffer();
        const reader = new FileReader();

        reader.onload = async function(e) {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, {type: 'array'});
            const rows = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]], {header: 1});
            
            // Ø³Ø­Ø¨ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙˆØªØ¬Ø§ÙˆØ² Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
            const names = rows.slice(1, 4).map(r => r[0]);

            for (let name of names) {
                if (name) await createPDF(pdfBytes, name.toString().toUpperCase());
            }
            document.getElementById('loader').style.display = 'none';
        };
        reader.readAsArrayBuffer(excelFile);
    }

    async function createPDF(baseBytes, name) {
        const { PDFDocument, rgb, StandardFonts } = PDFLib;
        const pdfDoc = await PDFDocument.load(baseBytes);
        const page = pdfDoc.getPages()[0];
        const { width, height } = page.getSize();
        const font = await pdfDoc.embedFont(StandardFonts.TimesRomanBold);

        const fontSize = height * 0.048;
        const textWidth = font.widthOfTextAtSize(name, fontSize);

        [span_0](start_span)// Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ù†Ø­Ø§Ø³ÙŠ Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ø£ØµÙ„[span_0](end_span)
        const copperColor = rgb(0.44, 0.24, 0.07); 

        page.drawText(name, {
            x: (width - textWidth) / 2,
            [span_1](start_span)y: height * 0.53, // Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØµØ­ÙŠØ­ Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØ¯Ø§Ø®Ù„[span_1](end_span)
            size: fontSize,
            font: font,
            color: copperColor,
        });

        const modifiedBytes = await pdfDoc.save();
        const url = URL.createObjectURL(new Blob([modifiedBytes], { type: 'application/pdf' }));
        
        addResultItem(name, url);
    }

    function addResultItem(name, url) {
        const div = document.createElement('div');
        div.className = "item-card";
        div.innerHTML = `
            <span><strong>ğŸ‘¤ ${name}</strong></span>
            <div class="action-btns">
                <a href="${url}" target="_blank" class="sub-btn preview-btn">ğŸ‘ï¸ Ù…Ø¹Ø§ÙŠÙ†Ø©</a>
                <a href="${url}" download="${name}.pdf" class="sub-btn download-btn">ğŸ“¥ ØªØ­Ù…ÙŠÙ„</a>
            </div>`;
        document.getElementById('resultArea').appendChild(div);
    }
</script>

</body>
</html>

