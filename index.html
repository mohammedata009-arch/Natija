
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ø°ÙƒÙŠ 2026</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body{
font-family:Segoe UI;
background:#f0f4f8;
padding:20px;
display:flex;
flex-direction:column;
align-items:center
}
.panel{
background:#fff;
padding:20px;
border-radius:15px;
box-shadow:0 4px 20px rgba(0,0,0,.1);
max-width:720px;
width:100%
}
.section{
background:#f9fbff;
padding:15px;
border-radius:10px;
border:1px solid #d6e4f0;
margin-bottom:15px
}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
label{font-weight:bold}
input,select{
width:100%;
padding:10px;
border-radius:8px;
border:1px solid #bcccdc
}
button{
padding:15px;
background:#004494;
color:#fff;
border:none;
border-radius:8px;
font-size:16px;
cursor:pointer
}
button:hover{background:#003371}
#log{margin:10px;text-align:center;font-weight:bold}
.canvas-container{
border:4px solid #004494;
margin-top:15px;
overflow:auto;
background:#fff
}
</style>
</head>

<body>

<div class="panel">
<h2 style="text-align:center">ğŸ“ Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</h2>

<div class="section">
<label>Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙˆØ§Ù„ØªÙˆÙ‚ÙŠØ¹</label>
<div class="grid">
<input type="file" id="bgInput" accept="image/*">
<input type="file" id="signInput" accept="image/*">
</div>
</div>

<div class="section">
<label>Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„</label>
<input type="file" id="excelInput" accept=".xls,.xlsx">
</div>

<div class="section">
<label>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</label>
<div class="grid">
<select id="currentTool">
<option value="trainee">Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¯Ø±Ø¨</option>
<option value="trainer">Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø¨</option>
<option value="course">Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</option>
<option value="date">Ø§Ù„ØªØ§Ø±ÙŠØ®</option>
<option value="serial">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ</option>
<option value="signature">Ø§Ù„ØªÙˆÙ‚ÙŠØ¹</option>
</select>
<input type="number" id="fSize" value="50">
</div>
<input type="color" id="fColor" value="#002d72">
</div>

<div id="log">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„...</div>
<button onclick="generateCertificates()">Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª ğŸš€</button>
</div>

<div class="canvas-container">
<canvas id="mainCanvas"></canvas>
</div>

<script>
const canvas=document.getElementById("mainCanvas");
const ctx=canvas.getContext("2d");

let bgImg=new Image();
let signImg=new Image();
let excelData=[];
let locations={};

document.getElementById("bgInput").onchange=e=>loadImage(e,bgImg,true);
document.getElementById("signInput").onchange=e=>loadImage(e,signImg,false);

function loadImage(e,img,isBg){
const reader=new FileReader();
reader.onload=f=>{
img.onload=()=>{
if(isBg){
canvas.width=img.width;
canvas.height=img.height;
renderPreview();
}
}
img.src=f.target.result;
}
reader.readAsDataURL(e.target.files[0]);
}

document.getElementById("excelInput").onchange=e=>{
const reader=new FileReader();
reader.onload=f=>{
const wb=XLSX.read(new Uint8Array(f.target.result),{type:"array"});
const rows=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]],{header:1});
excelData=rows.slice(1).map(r=>({
trainee:r[0],trainer:r[1],course:r[2],date:r[3]
}));
document.getElementById("log").innerText=`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${excelData.length} Ø§Ø³Ù…`;
}
reader.readAsArrayBuffer(e.target.files[0]);
};

canvas.addEventListener("mousedown",e=>{
const rect=canvas.getBoundingClientRect();
const tool=document.getElementById("currentTool").value;
locations[tool]={
x:(e.clientX-rect.left)*(canvas.width/rect.width),
y:(e.clientY-rect.top)*(canvas.height/rect.height),
size:document.getElementById("fSize").value,
color:document.getElementById("fColor").value
};
renderPreview();
});

function renderPreview(){
ctx.clearRect(0,0,canvas.width,canvas.height);
ctx.drawImage(bgImg,0,0);
ctx.fillStyle="rgba(255,0,0,.6)";
for(let k in locations){
ctx.beginPath();
ctx.arc(locations[k].x,locations[k].y,10,0,Math.PI*2);
ctx.fill();
}
}

async function generateCertificates(){
if(!bgImg.src||excelData.length==0)return alert("Ø§Ù„Ù…Ù„ÙØ§Øª Ù†Ø§Ù‚ØµØ©");
const {jsPDF}=window.jspdf;

for(let i=0;i<excelData.length;i++){
ctx.clearRect(0,0,canvas.width,canvas.height);
ctx.drawImage(bgImg,0,0);

const row=excelData[i];
const data={
trainee:row.trainee,
trainer:row.trainer,
course:row.course,
date:row.date,
serial:String(i+1).padStart(3,"0")
};

for(let k in locations){
const l=locations[k];
if(k==="signature"){
const w=canvas.width*.15;
const h=w*(signImg.height/signImg.width);
ctx.drawImage(signImg,l.x-w/2,l.y-h/2,w,h);
}else{
ctx.fillStyle=l.color;
ctx.font=`bold ${l.size}px Arial`;
ctx.textAlign="center";
ctx.fillText(data[k]||"",l.x,l.y);
}
}

const pdf=new jsPDF({
orientation:canvas.width>canvas.height?"l":"p",
unit:"px",
format:[canvas.width,canvas.height]
});
pdf.addImage(canvas.toDataURL("image/jpeg",1),"JPEG",0,0);
pdf.save(`Ø´Ù‡Ø§Ø¯Ø©_${row.trainee}.pdf`);
}
document.getElementById("log").innerText="ØªÙ… Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­ âœ…";
}
</script>

</body>
</html>
