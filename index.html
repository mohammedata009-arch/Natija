<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ø°ÙƒÙŠ</title>

<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body{font-family:Segoe UI;background:#f5f6fa;padding:20px;text-align:center}
.card{max-width:600px;margin:auto;background:#fff;padding:30px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,.1)}
input,button{width:100%;margin:10px 0;padding:12px}
button{background:#d35400;color:#fff;border:none;border-radius:8px;font-size:18px;cursor:pointer}
.preview{margin-top:20px}
</style>
</head>
<body>

<div class="card">
<h2>ğŸ“ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ù…Ù† Excel</h2>

<input type="file" id="pdfInput" accept=".pdf">
<input type="file" id="excelInput" accept=".xlsx,.xls">

<label>â¬‡ï¸ Ø¥Ù†Ø²Ø§Ù„ Ø§Ù„Ø§Ø³Ù… Ù„Ù„Ø£Ø³ÙÙ„ (Ù…Ø¹Ø§ÙŠÙ†Ø©)</label>
<input type="range" id="yOffset" min="0" max="200" value="40">
<div>Ø§Ù„Ù‚ÙŠÙ…Ø©: <span id="yVal">40</span></div>

<button onclick="start()">ğŸš€ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª</button>

<div id="result" class="preview"></div>
</div>

<script>
const ySlider=document.getElementById("yOffset");
const yVal=document.getElementById("yVal");
ySlider.oninput=()=>yVal.innerText=ySlider.value;

async function start(){
 const pdfFile=pdfInput.files[0];
 const excelFile=excelInput.files[0];
 if(!pdfFile||!excelFile) return alert("Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„ÙØ§Øª");

 const basePdf=await pdfFile.arrayBuffer();

 const reader=new FileReader();
 reader.onload=async e=>{
   const wb=XLSX.read(new Uint8Array(e.target.result),{type:"array"});
   const rows=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]],{header:1});
   const names=rows.slice(1).map(r=>r[0]).filter(Boolean);

   for(const name of names){
     await makePDF(basePdf,name.toString());
   }
 };
 reader.readAsArrayBuffer(excelFile);
}

async function makePDF(bytes,name){
 const {PDFDocument,StandardFonts,rgb}=PDFLib;
 const pdf=await PDFDocument.load(bytes);
 const page=pdf.getPages()[0];
 const {width,height}=page.getSize();

 const font=await pdf.embedFont(StandardFonts.TimesRomanBold);
 const fontSize=height*0.05;
 const textWidth=font.widthOfTextAtSize(name,fontSize);

 const offset=Number(ySlider.value);

 page.drawText(name,{
   x:(width-textWidth)/2,
   y:(height/2)-offset,
   size:fontSize,
   font,
   color:rgb(0.44,0.24,0.07)
 });

 const out=await pdf.save();
 const url=URL.createObjectURL(new Blob([out],{type:"application/pdf"}));

 const div=document.createElement("div");
 div.innerHTML=`ğŸ‘¤ ${name}
 <a href="${url}" target="_blank">Ù…Ø¹Ø§ÙŠÙ†Ø©</a> |
 <a href="${url}" download="Ø´Ù‡Ø§Ø¯Ø©_${name}.pdf">ØªØ­Ù…ÙŠÙ„</a>`;
 result.appendChild(div);
}
</script>

</body>
</html>
