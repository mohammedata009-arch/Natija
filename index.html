<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        .controls { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); width: 100%; max-width: 500px; margin-bottom: 20px; }
        input, select { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        button { padding: 12px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; }
        .btn-main { background: #002d72; color: white; grid-column: span 2; }
        .instruction { background: #fff3cd; padding: 10px; border-radius: 8px; font-size: 13px; margin: 10px 0; border: 1px solid #ffeeba; }
        .editor-container { position: relative; border: 2px solid #002d72; background: white; max-width: 100%; overflow: auto; display: none; }
        canvas { cursor: crosshair; }
    </style>
</head>
<body>

<div class="controls">
    <h2>ğŸ“ Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</h2>
    
    <label>1. Ø§Ø±ÙØ¹ Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©:</label>
    <input type="file" id="bgInput" accept="image/*">
    
    <label>2. Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ (PNG Ø´ÙØ§ÙØ©):</label>
    <input type="file" id="signInput" accept="image/*">

    <hr>
    <select id="activeField">
        <option value="trainee">Ù…ÙƒØ§Ù† Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¯Ø±Ø¨</option>
        <option value="trainer">Ù…ÙƒØ§Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø¨</option>
        <option value="course">Ù…ÙƒØ§Ù† Ø§Ø³Ù… Ø§Ù„ÙƒÙˆØ±Ø³</option>
        <option value="date">Ù…ÙƒØ§Ù† Ø§Ù„ØªØ§Ø±ÙŠØ®</option>
        <option value="serial">Ù…ÙƒØ§Ù† Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ</option>
        <option value="signature">Ù…ÙƒØ§Ù† Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ (Ø§Ù„ØµÙˆØ±Ø©)</option>
    </select>

    <input type="text" id="traineeVal" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¯Ø±Ø¨">
    <input type="text" id="trainerVal" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø¨">
    <input type="text" id="courseVal" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒÙˆØ±Ø³">
    <input type="text" id="dateVal" placeholder="Ø§Ù„ØªØ§Ø±ÙŠØ®">
    <input type="text" id="serialVal" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ">

    <button class="btn-main" onclick="downloadPDF()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© PDF âœ…</button>
    
    <div class="instruction">
        <strong>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¹Ù…Ù„:</strong> Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù†ØµØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (Ù…Ø«Ù„Ø§Ù‹: Ù…ÙƒØ§Ù† Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¯Ø±Ø¨) Ø«Ù… Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ù…ÙƒØ§Ù†Ù‡ Ø§Ù„ØµØ­ÙŠØ­ ÙÙŠ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¨Ø§Ù„Ø£Ø³ÙÙ„.
    </div>
</div>

<div id="wrapper" class="editor-container">
    <canvas id="canvas"></canvas>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let bgImg = new Image();
    let signImg = new Image();
    
    // ØªØ®Ø²ÙŠÙ† Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø¹Ù†Ø§ØµØ±
    let coords = {
        trainee: {x:0, y:0}, trainer: {x:0, y:0}, course: {x:0, y:0},
        date: {x:0, y:0}, serial: {x:0, y:0}, signature: {x:0, y:0}
    };

    document.getElementById('bgInput').onchange = (e) => {
        const reader = new FileReader();
        reader.onload = (ev) => {
            bgImg.onload = () => {
                document.getElementById('wrapper').style.display = 'block';
                canvas.width = bgImg.width;
                canvas.height = bgImg.height;
                draw();
            };
            bgImg.src = ev.target.result;
        };
        reader.readAsDataURL(e.target.files[0]);
    };

    document.getElementById('signInput').onchange = (e) => {
        const reader = new FileReader();
        reader.onload = (ev) => { signImg.src = ev.target.result; signImg.onload = draw; };
        reader.readAsDataURL(e.target.files[0]);
    };

    canvas.addEventListener('mousedown', (e) => {
        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;
        const field = document.getElementById('activeField').value;
        
        coords[field].x = (e.clientX - rect.left) * scaleX;
        coords[field].y = (e.clientY - rect.top) * scaleY;
        draw();
    });

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(bgImg, 0, 0);

        const data = {
            trainee: { val: document.getElementById('traineeVal').value, size: canvas.width/22, color: '#002d72' },
            trainer: { val: document.getElementById('trainerVal').value, size: canvas.width/45, color: '#333' },
            course: { val: document.getElementById('courseVal').value, size: canvas.width/30, color: '#002d72' },
            date: { val: document.getElementById('dateVal').value, size: canvas.width/50, color: '#444' },
            serial: { val: document.getElementById('serialVal').value, size: canvas.width/60, color: '#444' }
        };

        for (let key in data) {
            if (coords[key].x !== 0) {
                // Ù…Ø³Ø­ Ø§Ù„Ø®Ù„ÙÙŠØ© ØªØ­Øª Ø§Ù„Ù†Øµ
                ctx.fillStyle = "white"; 
                ctx.fillRect(coords[key].x - (canvas.width*0.2), coords[key].y - (data[key].size), canvas.width*0.4, data[key].size * 1.5);
                
                // ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù†Øµ
                ctx.fillStyle = data[key].color;
                ctx.font = `bold ${data[key].size}px Arial`;
                ctx.textAlign = "center";
                ctx.fillText(data[key].val, coords[key].x, coords[key].y);
            }
        }

        // Ø±Ø³Ù… Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ ÙƒØµÙˆØ±Ø©
        if (coords.signature.x !== 0 && signImg.src) {
            const sW = canvas.width * 0.15;
            const sH = (signImg.height / signImg.width) * sW;
            ctx.drawImage(signImg, coords.signature.x - sW/2, coords.signature.y - sH/2, sW, sH);
        }
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ù… Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø©
    ['traineeVal', 'trainerVal', 'courseVal', 'dateVal', 'serialVal'].forEach(id => {
        document.getElementById(id).oninput = draw;
    });

    async function downloadPDF() {
        const imgData = canvas.toDataURL('image/jpeg', 1.0);
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF({
            orientation: canvas.width > canvas.height ? 'l' : 'p',
            unit: 'px',
            format: [canvas.width, canvas.height]
        });
        pdf.addImage(imgData, 'JPEG', 0, 0, canvas.width, canvas.height);
        pdf.save(`Ø´Ù‡Ø§Ø¯Ø©_${document.getElementById('traineeVal').value}.pdf`);
    }
</script>

</body>
</html>

